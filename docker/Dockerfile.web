# 前端镜像（Nginx托管）
# docker/Dockerfile.web
# ---- build stage ----
FROM node:20-alpine AS build
WORKDIR /app
COPY package.json pnpm-lock.yaml* package-lock.json* yarn.lock* ./
# 任选一种：pnpm / npm / yarn（以下示例用 pnpm）
RUN corepack enable && corepack prepare pnpm@latest --activate
RUN pnpm install --frozen-lockfile
COPY . .
RUN pnpm build

# ---- run stage (nginx) ----
FROM nginx:1.27-alpine
COPY nginx/nginx.conf /etc/nginx/nginx.conf
# 拷贝前端构建产物到 nginx 目录
COPY --from=build /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
